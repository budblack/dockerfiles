worker_processes  1;
events {
  worker_connections  1024;
}

stream {
  upstream gitlab_ssh {
      hash $remote_addr consistent;
      server 192.168.0.174:22;
  }
 
  upstream gitlab_http {
      hash $remote_addr consistent;
      server 192.168.0.174:9380;
  }
  
  upstream gitlab_https {
      hash $remote_addr consistent;
      server 192.168.0.174:9343;
  }
  
  
  server {
      listen 22;
      proxy_connect_timeout 10s;
      proxy_timeout 10m;
      proxy_pass gitlab_ssh;
  }
  server {
      listen 80;
      proxy_connect_timeout 10s;
      proxy_timeout 10m;
      proxy_pass gitlab_http;
  }
  server {
      listen 443;
      proxy_connect_timeout 10s;
      proxy_timeout 10m;
      proxy_pass gitlab_https;
  }
}
